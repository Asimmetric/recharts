machine:
  node:
    version: 6.9.3
  post:
    - npm install -g npm@3.10.7
deploy:
  release:
    branch: master
    commands:
      - npm run build
      - tar -cvzf release.tar.gz README.md package.json LICENSE umd/ lib/ es6/
      - COMMIT_COUNT=$(git rev-list --count master)
      - RELEASE_ID=$(curl --data "{\"tag_name\": \"v0.0.$COMMIT_COUNT\",\"target_commitish\": \"master\",\"name\": \"v0.0.$COMMIT_COUNT\",\"draft\": true,\"prerelease\": false}" https://api.github.com/repos/Asimmetric/recharts/releases?access_token=$GITHUB_AUTH_TOKEN | python -c "import sys, json; print json.load(sys.stdin)['id']")
      - curl -XPOST -H "Authorization:token $GITHUB_AUTH_TOKEN" -H "Content-Type:application/octet-stream" --data-binary @release.tar.gz https://uploads.github.com/repos/Asimmetric/recharts/releases/$RELEASE_ID/assets?name=release.tar.gz